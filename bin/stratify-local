#!/usr/bin/env bb
;; -*- clojure -*-
;; vim: set filetype=clojure:
#_{:clj-kondo/ignore [:namespace-name-mismatch]}
(ns stratify
  (:require
   [babashka.fs :as fs]
   [babashka.process :refer [process]]))

(defn -main [& args]
  (let [project-path (-> (fs/real-path *file*) fs/parent fs/parent)
        deps (pr-str {:deps {'org.clojure/clojure {:mvn/version "1.12.0"}
                             'io.github.dundalek/stratify {:local/root (str project-path)}
                             'stratify/studio {:local/root (str project-path "/packages/studio")}}})
        proc (apply process {:inherit true
                             :extra-env {"STRATIFY_PORTAL_BUNDLE_PATH" (str project-path "/packages/portal/resources/portal-dev/main.js")}}
                    "clojure" "-Sdeps" deps
                    "-M" "-m" "stratify.main" args)]
    (System/exit (:exit @proc))))

(when (= *file* (System/getProperty "babashka.file"))
  (apply -main *command-line-args*))
